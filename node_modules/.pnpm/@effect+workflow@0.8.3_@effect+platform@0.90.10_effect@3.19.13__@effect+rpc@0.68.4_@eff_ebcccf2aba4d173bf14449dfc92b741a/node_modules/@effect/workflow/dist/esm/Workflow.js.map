{"version":3,"file":"Workflow.js","names":["Cause","Context","Data","Effect","Exit","constFalse","constTrue","dual","identity","Layer","Option","Predicate","PrimaryKey","Schedule","Schema","makeHashDigest","TypeId","Symbol","for","EngineTag","GenericTag","InstanceTag","make","options","suspendedRetrySchedule","defaultRetrySchedule","makeExecutionId","payload","name","idempotencyKey","self","payloadSchema","isSchema","Struct","successSchema","success","Void","errorSchema","error","Never","annotations","empty","annotate","tag","value","add","annotateContext","context","merge","execute","fnUntraced","fields","opts","engine","executionId","annotateCurrentSpan","discard","workflow","parentInstance","serviceOption","run","parent","getOrUndefined","isSome","result","wrapActivityResult","_tag","suspended","interrupt","exit","sleep","driver","next","pipe","catchAll","dieMessage","withSpan","captureStackTrace","effect","attributes","resume","toLayer","effectContext","gen","get","register","mapInputContext","input","withCompensation","exponential","union","spaced","fromTaggedRequest","schema","failure","ResultTypeId","isResult","u","hasProperty","Complete","TaggedClass","SchemaFromSelf","_options","declare","SchemaEncoded","defect","Defect","transform","decode","fromA","encode","toI","Suspended","cause","optional","Result","Union","intoResult","contextWithEffect","instance","captureDefects","CaptureDefects","suspendOnFailure","SuspendOnFailure","uninterruptibleMask","restore","catchAllCause","isInterruptedOnly","die","squash","scoped","matchCauseEffect","onSuccess","succeed","onFailure","interrupted","isDie","failCause","isSuspend","state","activityState","count","latch","await","andThen","yieldNow","unsafeClose","onExit","isSuspended","isSuccess","sequential","open","void","compensation","tap","addFinalizer","Reference","defaultValue"],"sources":["../../src/Workflow.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]}